<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Dashboard - Holliday's Lawn & Garden</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="icon" type="image/png" href="assets/images/favicon/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="assets/images/favicon/favicon-16x16.png" sizes="16x16">
  <link rel="shortcut icon" href="assets/images/favicon/favicon.ico">
  <link rel="apple-touch-icon" href="assets/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/images/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/images/favicon/android-chrome-512x512.png">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f4f6f8;
      color: #222;
    }
    .dashboard-wrapper {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      background: #2e7d32;
      color: #fff;
      width: 240px;
      min-width: 200px;
      padding: 2rem 1rem 1rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 2px 0 8px rgba(0,0,0,0.04);
    }
    .sidebar .logo {
      margin-bottom: 2rem;
    }
    .sidebar .logo img {
      max-width: 120px;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    .sidebar nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 100%;
    }
    .sidebar nav ul li {
      margin: 1rem 0;
    }
    .sidebar nav ul li a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: color 0.2s;
    }
    .sidebar nav ul li a:hover {
      color: #b2dfdb;
    }
    .sidebar .logout-btn {
      margin-top: auto;
      background: #fff;
      color: #2e7d32;
      border: none;
      border-radius: 4px;
      padding: 0.5rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .sidebar .logout-btn:hover {
      background: #b2dfdb;
      color: #222;
    }
    .dashboard-main {
      flex: 1;
      padding: 2rem 3vw;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      background: #f4f6f8;
    }
    .dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .dashboard-header .greeting {
      font-size: 1.5rem;
      font-weight: 600;
    }
    .dashboard-header .notifications {
      position: relative;
      font-size: 1.3rem;
      cursor: pointer;
      color: #2e7d32;
    }
    .dashboard-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 2rem;
    }
    .dashboard-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 1.5rem 1.25rem;
      min-height: 220px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .dashboard-card h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1.2rem;
      color: #2e7d32;
    }
    .dashboard-card ul {
      padding-left: 1.2rem;
    }
    .dashboard-card .empty {
      color: #888;
      font-size: 1rem;
      margin-top: 1rem;
    }
    .dashboard-card form input,
    .dashboard-card form select,
    .dashboard-card form textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }
    .dashboard-card form button {
      background: #2e7d32;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 0.5rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    .dashboard-card form button:hover {
      background: #388e3c;
    }
    @media (max-width: 900px) {
      .dashboard-wrapper {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        min-width: unset;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
      }
      .sidebar nav ul {
        display: flex;
        flex-direction: row;
        gap: 1rem;
      }
      .dashboard-main {
        padding: 1rem 2vw;
      }
      .dashboard-sections {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-wrapper">
    <aside class="sidebar">
      <div class="logo">
        <a href="index.html">
          <img src="assets/images/hollidays-logo.optimized-1280.png" alt="Holliday's Lawn & Garden Logo" loading="lazy">
        </a>
      </div>
      <nav>
        <ul>
          <li><a href="customer-dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
          <li><a href="pay-your-bill.html"><i class="fas fa-file-invoice-dollar"></i> Pay Your Bill</a></li>
          <li><a href="services.html"><i class="fas fa-leaf"></i> Services</a></li>
          <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
          <li><a href="contact.html"><i class="fas fa-envelope"></i> Contact</a></li>
        </ul>
      </nav>
      <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </aside>
    <main class="dashboard-main">
      <div class="dashboard-header">
        <div class="greeting">Welcome, <span id="customerName">Customer</span>!</div>
        <div class="notifications" title="Notifications">
          <i class="fas fa-bell"></i>
          <span class="badge" id="notificationCount" style="display:none;position:absolute;top:-8px;right:-8px;background:#e53935;color:#fff;border-radius:50%;padding:2px 7px;font-size:0.8rem;font-weight:700;">0</span>
        </div>
      </div>
      <section class="dashboard-sections">
        <div class="dashboard-card" id="serviceRequests">
          <h3>Your Service Requests</h3>
          <ul>
            <li class="empty">No service requests yet.</li>
          </ul>
        </div>
        <div class="dashboard-card" id="newRequest">
          <h3>Submit New Service Request</h3>
          <form id="requestForm">
            <label for="serviceType">Service Type</label>
            <select id="serviceType" required>
              <option value="">Select...</option>
              <option value="Lawn Mowing">Lawn Mowing</option>
              <option value="Hedge Trimming">Hedge Trimming</option>
              <option value="Leaf Cleanup">Leaf Cleanup</option>
              <option value="Mulching">Mulching</option>
              <option value="Fertilization">Fertilization</option>
              <option value="Weed Control">Weed Control</option>
              <option value="Garden Design">Garden Design</option>
              <option value="Seasonal Cleanup">Seasonal Cleanup</option>
              <option value="Driveway Pressure Washing">Driveway Pressure Washing</option>
              <option value="Sidewalk Pressure Washing">Sidewalk Pressure Washing</option>
              <option value="Patio Pressure Washing">Patio Pressure Washing</option>
              <option value="Deck Pressure Washing">Deck Pressure Washing</option>
              <option value="Fence Pressure Washing">Fence Pressure Washing</option>
              <option value="House Exterior Pressure Washing">House Exterior Pressure Washing</option>
            </select>
            <label for="preferredDate">Preferred Date</label>
            <input type="date" id="preferredDate" required>
            <label for="requestNotes">Notes</label>
            <textarea id="requestNotes" placeholder="Any special instructions..."></textarea>
            <button type="submit">Submit Request</button>
          </form>
        </div>
        <div class="dashboard-card" id="upcomingAppointments">
          <h3>Upcoming Appointments</h3>
          <ul>
            <li class="empty">No upcoming appointments.</li>
          </ul>
        </div>
        <div class="dashboard-card" id="invoices">
          <h3>Invoices & Payments</h3>
          <ul>
            <li class="empty">No invoices found.</li>
          </ul>
        </div>
        <div class="dashboard-card" id="profile">
          <h3>Profile</h3>
          <ul>
            <li>Name: <span id="profileName">Customer</span></li>
            <li>Email: <span id="profileEmail">customer@email.com</span></li>
            <li><a href="#" style="color:#2e7d32;">Edit Profile</a></li>
          </ul>
        </div>
        <div class="dashboard-card" id="support">
          <h3>Support / Contact</h3>
          <form id="supportForm">
            <label for="supportMessage">Message</label>
            <textarea id="supportMessage" required placeholder="How can we help you?"></textarea>
            <button type="submit">Send Message</button>
          </form>
        </div>
      </section>
    </main>
  </div>
  <footer class="footer" role="contentinfo" aria-label="Site footer" style="margin-top:2rem;">
    <div class="footer-content">
      <div class="footer-main">
        <div class="footer-section">
          <h3>Contact Us</h3>
          <div class="footer-contact">
            <span class="footer-owner">Karl Holliday</span>
            <a href="tel:+15047171887" aria-label="Call us">
              <i class="fas fa-phone" aria-hidden="true"></i>
              <span>(504) 717-1887</span>
            </a>
            <a href="mailto:7holliday@gmail.com" aria-label="Email us">
              <i class="fas fa-envelope" aria-hidden="true"></i>
              <span>7holliday@gmail.com</span>
            </a>
          </div>
        </div>
        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="services.html">Services</a></li>
            <li><a href="education.html">Education</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Customer Portal</h3>
          <ul>
            <li><a href="login.html">Login</a></li>
            <li><a href="register.html">Register</a></li>
            <li><a href="pay-your-bill.html">Pay Your Bill</a></li>
            <li><a href="customer-dashboard.html">Dashboard</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Legal</h3>
          <ul>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="terms.html">Terms of Service</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Connect With Us</h3>
          <div class="footer-social">
            <a href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook">
              <i class="fab fa-facebook" aria-hidden="true"></i>
            </a>
            <a href="https://twitter.com" target="_blank" rel="noopener" aria-label="Twitter">
              <i class="fab fa-twitter" aria-hidden="true"></i>
            </a>
            <a href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram">
              <i class="fab fa-instagram" aria-hidden="true"></i>
            </a>
            <a href="https://linkedin.com" target="_blank" rel="noopener" aria-label="LinkedIn">
              <i class="fab fa-linkedin" aria-hidden="true"></i>
            </a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; <span id="current-year"></span> Holliday's Lawn & Garden. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Firebase Auth, Firestore, and All Dashboard Features -->
  <script type="module">
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs, addDoc, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { app } from './assets/js/firebase-config.js';

    const auth = getAuth(app);
    const db = getFirestore(app);

    // Personalized greeting and profile
    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById('customerName').textContent = user.displayName || user.email || "Customer";
        document.getElementById('profileName').textContent = user.displayName || "Customer";
        document.getElementById('profileEmail').textContent = user.email || "";
        loadServiceRequests(user);
        loadUpcomingAppointments(user);
        loadInvoices(user);
        loadNotifications(user);
      } else {
        window.location.href = "login.html";
      }
    });

    // Logout button
    document.querySelector('.logout-btn').addEventListener('click', () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });

    // Service Requests
    function loadServiceRequests(user) {
      const list = document.querySelector('#serviceRequests ul');
      list.innerHTML = '<li class="empty">Loading...</li>';
      const q = query(
        collection(db, "service_requests"),
        where("customerEmail", "==", user.email)
      );
      getDocs(q).then(snapshot => {
        list.innerHTML = '';
        if (snapshot.empty) {
          list.innerHTML = '<li class="empty">No service requests yet.</li>';
          return;
        }
        snapshot.forEach(doc => {
          const r = doc.data();
          list.innerHTML += `<li>
            <strong>${r.serviceType}</strong> on ${r.preferredDate || "N/A"}
            <br>Status: ${r.status || "Pending"}
            <br>Notes: ${r.notes || "-"}
          </li>`;
        });
      });
    }
    document.getElementById('requestForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return;
      const type = document.getElementById('serviceType').value;
      const date = document.getElementById('preferredDate').value;
      const notes = document.getElementById('requestNotes').value;
      await addDoc(collection(db, "service_requests"), {
        customerEmail: user.email,
        serviceType: type,
        preferredDate: date,
        notes: notes,
        status: "Pending",
        submittedAt: serverTimestamp()
      });
      e.target.reset();
      loadServiceRequests(user);
    });

    // Upcoming Appointments
    function loadUpcomingAppointments(user) {
      const list = document.querySelector('#upcomingAppointments ul');
      list.innerHTML = '<li class="empty">Loading...</li>';
      const q = query(
        collection(db, "appointments"),
        where("customerEmail", "==", user.email),
        orderBy("date", "asc"),
        limit(5)
      );
      getDocs(q).then(snapshot => {
        list.innerHTML = '';
        if (snapshot.empty) {
          list.innerHTML = '<li class="empty">No upcoming appointments.</li>';
          return;
        }
        snapshot.forEach(doc => {
          const a = doc.data();
          list.innerHTML += `<li>
            <strong>${a.serviceType}</strong> on ${a.date ? new Date(a.date).toLocaleDateString() : "N/A"}
            <br>Status: ${a.status || "Scheduled"}
          </li>`;
        });
      });
    }

    // Invoices & Payments
    function loadInvoices(user) {
      const list = document.querySelector('#invoices ul');
      list.innerHTML = '<li class="empty">Loading...</li>';
      const q = query(
        collection(db, "invoices"),
        where("customerEmail", "==", user.email),
        orderBy("dueDate", "desc"),
        limit(5)
      );
      getDocs(q).then(snapshot => {
        list.innerHTML = '';
        if (snapshot.empty) {
          list.innerHTML = '<li class="empty">No invoices found.</li>';
          return;
        }
        snapshot.forEach(doc => {
          const inv = doc.data();
          list.innerHTML += `<li>
            <strong>Amount:</strong> $${inv.amount} - <strong>Status:</strong> ${inv.status || "Unpaid"}
            <br>Due: ${inv.dueDate ? new Date(inv.dueDate).toLocaleDateString() : "N/A"}
          </li>`;
        });
      });
    }

    // Notifications
    function loadNotifications(user) {
      const badge = document.getElementById('notificationCount');
      const q = query(
        collection(db, "notifications"),
        where("customerEmail", "==", user.email),
        orderBy("createdAt", "desc"),
        limit(10)
      );
      getDocs(q).then(snapshot => {
        let count = 0;
        snapshot.forEach(doc => {
          const n = doc.data();
          if (!n.read) count++;
        });
        if (count > 0) {
          badge.textContent = count;
          badge.style.display = 'inline-block';
        } else {
          badge.style.display = 'none';
        }
      });
    }

    // Support/Contact Form
    document.getElementById('supportForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      const message = document.getElementById('supportMessage').value;
      if (!user || !message) return;
      await addDoc(collection(db, "support_messages"), {
        customerEmail: user.email,
        message: message,
        createdAt: serverTimestamp()
      });
      e.target.reset();
      alert('Your message has been sent!');
    });
  </script>
</body>
</html>
